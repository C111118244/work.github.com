<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <title>千塘之鄉互動遊戲</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="hamburger" onclick="toggleMenu()">☰</div>

  <div id="sidebar" class="sidebar">
    <div class="nav-top">
      <button onclick="goPrevPage()">← 上一頁</button>
      <button onclick="goNextPage()">下一頁 →</button>
    </div>
    <hr>
    <p><strong>挑戰者：</strong><span id="usernameDisplay">尚未登入</span></p>
    <p><strong>目前分數：</strong><span id="scoreDisplay">0</span></p>
    <hr>
    <button onclick="switchToPage('coverPage')">🏠 回首頁</button>
    <button onclick="switchToPage('vocabPage')">📚 生詞練習</button><br>
    <button onclick="saveProgress()">💾 Save</button><br>
    <button onclick="restartGame()">🔁 Restart</button>
  </div>

  <section id="coverPage" class="cover">
    <h1>千塘之鄉互動學習遊戲</h1>
    <img src="images/cover.jpg" alt="封面圖" class="cover-img">
    <p><a href="#" class="description-link" onclick="switchToPage('aboutPage')">▶ 點我查看我完成了什麼內容</a></p>
    <div class="input-section">
      <input type="text" id="nameInput" placeholder="請輸入你的名字">
      <button onclick="startGame()">開始遊戲</button>
    </div>
  </section>

  <section id="aboutPage" class="cover" style="display: none;">
    <h1>我完成了什麼內容</h1>
    <ul style="text-align: left; max-width: 600px; margin: 0 auto; font-size: 18px; line-height: 2;">
      <p>✔️ 標題，封面圖，說明（說明你完成的部分），開始遊戲</p>
      <p>✔️ StoryBanner設計中原校徽</p>
      <p>✔️ 輸入姓名，greeting</p>
      <p>✔️ 整體設定CSS文本字型，標題用庫楷，內文用水筆仔</p>
      <p>✔️ 一個passage包含一張圖片，盡量避免scroll-down。</p>
      <p>✔️ 圖片處理後放入images中，也可用css設定圖片大小，置中。（請自己找圖）。</p>
      <p>✔️ 文字延後打字效果。</p>
      <p>✔️ 一個段落放置幾個測驗題，提供feedback。ifelse，總分100分（與google表單的測驗卷不同）</p>
      <p>✔️ StoryCaption 顯示挑戰者姓名；測驗題得分；</p>
      <p>✔️ google 測驗題共10題，總分100分。</p>
      <p>✔️ span 元素選擇器選生詞，class選擇器設定商
        務詞彙與文化詞彙，可連結生詞的passage並跳回。生詞的passage包含（生詞，英文解釋，漢拼，造句。）</p>

    </ul>
    <button onclick="switchToPage('coverPage')">⬅ 回首頁</button>
  </section>

  <section id="passage1" class="passage" style="display: none;">
    <h1 class="main-title">千塘之鄉</h1>
    <p class="passage-text">
      「陳主任是幸福高中的主任，他計畫在這學期設計關於埤塘生態活動的課程，讓學生們可以多了解埤塘的歷史，除了能讓他們把埤塘的故事帶回自己的社區與家庭，也能讓更多人了解埤塘對我們來說是非常重要的，應該要好好保護它。」
    </p>
    <img src="images/cover.jpg" alt="配圖" class="cover-img">
    <button onclick="unlockAndGo('question1')">下一頁 →</button>
  </section>

  <section id="question1" class="question" style="display: none;">
    <p class="question-title">📘 小測驗：請問陳主任想設計關於什麼的活動呢？</p>
    <button class="answer-btn" onclick="checkAnswer(this, '埤塘生態', 'passage2')">動物園生態</button>
    <button class="answer-btn" onclick="checkAnswer(this, '埤塘生態', 'passage2')">埤塘生態</button>
    <button class="answer-btn" onclick="checkAnswer(this, '埤塘生態', 'passage2')">果園生態</button>
    <p id="feedback" class="feedback"></p>
    <button onclick="goNextPage()">下一頁 →</button>
  </section>

  <section id="passage2" class="passage" style="display: none;">
    <h1 class="main-title">千塘之鄉</h1>
    <p class="passage-text">
      「在課程設計的部分，陳主任會先帶學生實際到埤塘熟悉環境，說明埤塘的歷史與文化，再讓他們思考可以怎麼保護這個珍貴的資源。除了可以讓學生在規定的時間到埤塘附近的路上撿垃圾、保護環境以外，還能購買水生植物來讓埤塘變乾淨。水生植物的種類很多，主任會先告訴學生們哪些是可以幫助埤塘環境的植物，像是布袋蓮可以排除重金屬；大甲草可以讓水流得比較慢；水芋可以調整水裡的酸性等等。」
    </p>
    <img src="images/cover.jpg" alt="配圖" class="cover-img">
    <button onclick="unlockAndGo('question2')">下一頁 →</button>
  </section>

  <section id="question2" class="question" style="display: none;">
    <p class="question-title">📘 小測驗：請問布袋蓮可以排除什麼呢？</p>
    <button class="answer-btn" onclick="checkAnswer(this, '重金屬', 'passage3')">重銀屬</button>
    <button class="answer-btn" onclick="checkAnswer(this, '重金屬', 'passage3')">米老鼠</button>
    <button class="answer-btn" onclick="checkAnswer(this, '重金屬', 'passage3')">重金屬</button>
    <p id="feedback" class="feedback"></p>
    <button onclick="goNextPage()">下一頁 →</button>
  </section>

  <section id="passage3" class="passage" style="display: none;">
    <h1 class="main-title">千塘之鄉</h1>
    <p class="passage-text">
      「還會跟學生介紹「綠色產品」，綠色產品是什麼呢？就是產品在製造或是銷售的過程中，具有可回收、低污染的功能，例如綠色汽車、綠色食品、綠色建築等等，讓學生了解愛護環境的方式有哪些。」
    </p>
    <img src="images/cover.jpg" alt="配圖" class="cover-img">
    <button onclick="unlockAndGo('question3')">下一頁 →</button>
  </section>

  <section id="question3" class="question" style="display: none;">
    <p class="question-title">📘 小測驗：請問會跟學生介紹什麼產品呢？</p>
    <button class="answer-btn" onclick="checkAnswer(this, '綠色產品', 'passage4')">紅色產品</button>
    <button class="answer-btn" onclick="checkAnswer(this, '綠色產品', 'passage4')">綠色產品</button>
    <button class="answer-btn" onclick="checkAnswer(this, '綠色產品', 'passage4')">黃色產品</button>
    <p class="feedback"></p>
    <button onclick="goNextPage()">下一頁 →</button>
  </section>

  <section id="passage4" class="passage" style="display: none;">
    <h1 class="main-title">千塘之鄉</h1>
    <p class="passage-text">
      「另外，陳主任的朋友是埤塘生態的保護員，他邀請陳主任帶著學生一起進行太陽能水泵計畫，就是要跟社區裡的電器行合作，利用太陽能水泵來維持埤塘的灌溉，達到永續發展。這些對學生來說都是很不一樣的學習體驗，這樣的環境教育，學生們可以知道更多關於埤塘的故事與意義，未來也會更加保護自己生活的環境。」
    </p>
    <img src="images/cover.jpg" alt="配圖" class="cover-img">
    <button onclick="unlockAndGo('question4')">下一頁 →</button>
  </section>


  <section id="question4" class="question" style="display: none;">
    <p class="question-title">📘 小測驗：請問他們要進行什麼計畫呢？</p>
    <button class="answer-btn" onclick="checkAnswer(this, '太陽能水泵計畫', 'summaryPage')">保衛地球計畫</button>
    <button class="answer-btn" onclick="checkAnswer(this, '太陽能水泵計畫', 'summaryPage')">沒有計劃</button>
    <button class="answer-btn" onclick="checkAnswer(this, '太陽能水泵計畫', 'summaryPage')">太陽能水泵計畫</button>
    <p class="feedback"></p>
    <button onclick="goNextPage()">下一頁 →</button>
  </section>

  <section id="summaryPage" style="display: none;" class="cover">
    <h1>🎉 恭喜完成所有挑戰！</h1>
    <p>挑戰者：<span id="summaryName"></span></p>
    <p>總得分：<span id="summaryScore"></span> 分</p>

    <p style="margin-top: 40px; font-size: 18px;">
      請幫我填寫這份問卷，讓我更了解你的學習體驗：
    </p>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSce9pIPySk3s1VfxpBgK7rgWW3193fVj2f1BynAD-FcQOf7eQ/viewform?usp=dialog"
      target="_blank">
      <button>📝 填寫問卷</button>
    </a>

    <br><br>
    <button onclick="switchToPage('coverPage')">🏠 回到首頁</button>
  </section>

  <script>
    let currentPage = 'coverPage';

    const alwaysAllowedPages = ['coverPage', 'aboutPage', 'vocabPage'];

    function unlockAndGo(pageId) {
      localStorage.setItem(pageId + '_unlocked', 'true');
      switchToPage(pageId);
    }

    function switchToPage(pageId) {
      if (!alwaysAllowedPages.includes(pageId) && localStorage.getItem(pageId + '_unlocked') !== 'true') {
        alert("請先完成上一段內容！");
        return;
      }
      document.getElementById(currentPage).style.display = 'none';
      document.getElementById(pageId).style.display = 'block';
      currentPage = pageId;

      if (pageId === 'summaryPage') {
        document.getElementById("summaryName").innerText = localStorage.getItem("username");
        document.getElementById("summaryScore").innerText = localStorage.getItem("score");
      }
    }

    function toggleMenu() {
      document.getElementById("sidebar").classList.toggle("show");
    }

    function startGame() {
      const name = document.getElementById("nameInput").value;
      if (!name) {
        alert("請輸入你的名字！");
        return;
      }
      localStorage.setItem("username", name);
      localStorage.setItem("score", "0");
      localStorage.setItem("passage1_unlocked", "true");
      document.getElementById("usernameDisplay").innerText = name;
      document.getElementById("scoreDisplay").innerText = "0";
      alert("歡迎 " + name + "，開始進入遊戲！");
      switchToPage("passage1");
    }

    if (performance.getEntriesByType("navigation")[0].type === "reload") {
      localStorage.clear();
      location.href = "index.html";
    }

    window.onload = function () {
      const name = localStorage.getItem("username");
      const score = localStorage.getItem("score") || "0";
      if (name && document.getElementById("usernameDisplay")) {
        document.getElementById("usernameDisplay").innerText = name;
      }
      if (document.getElementById("scoreDisplay")) {
        document.getElementById("scoreDisplay").innerText = score;
      }

      const visibleSection = Array.from(document.querySelectorAll("section"))
        .find(sec => sec.style.display !== 'none');

      if (visibleSection && visibleSection.id.includes("question")) {
        if (localStorage.getItem(visibleSection.id + '_answered') === 'true') {
          const btns = visibleSection.querySelectorAll(".answer-btn");
          btns.forEach(b => b.disabled = true);
        }
      }
    };

    function goPrevPage() {
      const pages = getOrderedPages();
      const index = pages.indexOf(currentPage);
      if (index > 0) {
        switchToPage(pages[index - 1]);
      }
    }

    function goNextPage() {
      const pages = getOrderedPages();
      const index = pages.indexOf(currentPage);
      if (index < pages.length - 1) {
        switchToPage(pages[index + 1]);
      } else {
        alert("🎉 恭喜你已完成所有內容！");
        switchToPage('summaryPage');
      }
    }

    function checkAnswer(button, correctAnswer, unlockNextPageId) {
      const section = button.closest('section');
      const sectionId = section.id;
      const feedback = section.querySelector(".feedback");

      const allButtons = button.parentElement.querySelectorAll(".answer-btn");

      if (button.innerText === correctAnswer) {
        feedback.innerText = "✅ 恭喜答對了！加 25 分！";
        feedback.style.color = "green";

        let currentScore = parseInt(localStorage.getItem("score") || "0");
        currentScore += 25;
        localStorage.setItem("score", currentScore);
        document.getElementById("scoreDisplay").innerText = currentScore;

        allButtons.forEach(btn => btn.disabled = true);
      } else {
        feedback.innerText = "❌ 答錯了，再試一次！";
        feedback.style.color = "red";
      }

      localStorage.setItem(sectionId + '_answered', 'true');

      if (unlockNextPageId) {
        localStorage.setItem(unlockNextPageId + '_unlocked', 'true');
      }
    }

    function saveProgress() {
      alert("進度已儲存！");
    }

    function restartGame() {
      if (confirm("確定要重新開始嗎？")) {
        localStorage.clear();
        location.href = "index.html";
      }
    }

    function getOrderedPages() {
      return [
        'coverPage',
        'passage1',
        'question1',
        'passage2',
        'question2',
        'passage3',
        'question3',
        'passage4',
        'question4',
        'summaryPage'
      ];
    }
  </script>
  <script src="script.js"></script>
  <section id="vocabPage" class="cover" style="display: none;">
    <h1>📚 生詞練習</h1>
    <iframe style="max-width:100%"
      src="https://wordwall.net/embed/32dbecc16c28479999cc883bafc2e428?themeId=1&templateId=3&fontStackId=0" width="500"
      height="380" frameborder="0" allowfullscreen></iframe>
    <br>
    <button onclick="switchToPage('coverPage')">⬅ 回首頁</button>
  </section>
</body>

</html>